[metadata]
name = "tree"
description = "Browse directory tree and select files/folders"
requirements = ["tree"]

[source]
# Show tree visualization with colors and structure
# -C = colorize, -f = full path, --noreport = no summary, -I = ignore pattern
# This shows the tree structure on left but includes full paths
# Toggle between normal and hidden files with ctrl-t
command = ["tree -C -f -I .git --noreport", "tree -C -f -a -I .git --noreport"]
# Use ansi to preserve colors in the display
ansi = true
# Extract the path (last field after all the tree characters)
output = "{strip_ansi|split: :-1}"

[preview]
# Show context for the selected path
# Use template operations to extract the path
# Cycle between showing and hiding hidden files in preview with ctrl-p
command = [
  '''
filepath={strip_ansi|split: :-1}
if [ -d "$filepath" ]; then
  tree -C -I .git -L 3 "$filepath"
elif [ -f "$filepath" ]; then
  bat -n --color=always "$filepath" 2>/dev/null || cat "$filepath"
else
  echo "Could not preview: $filepath"
fi
''',
  '''
filepath={strip_ansi|split: :-1}
if [ -d "$filepath" ]; then
  tree -C -a -I .git -L 3 "$filepath"
elif [ -f "$filepath" ]; then
  bat -n --color=always "$filepath" 2>/dev/null || cat "$filepath"
else
  echo "Could not preview: $filepath"
fi
'''
]

[ui.preview_panel]
size = 60

[keybindings]
shortcut = "f4"
ctrl-e = "actions:edit"
ctrl-o = "actions:open"

[actions.edit]
description = "Edit the selected file/directory with $EDITOR"
command = '''filepath={strip_ansi|split: :-1}; nvim "$filepath"'''
mode = "execute"

[actions.open]
description = "Open with default application (xdg-open)"
command = '''filepath={strip_ansi|split: :-1}; xdg-open "$filepath" 2>/dev/null || open "$filepath" 2>/dev/null || echo 'No open command available' '''
mode = "fork"
